/scratch/slurm-user3/anaconda3/envs/minigpt4/lib/python3.9/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: libtorch_cuda_cu.so: cannot open shared object file: No such file or directory
  warn(f"Failed to load image Python extension: {e}")
2023-10-28 23:16:59,202 [INFO] 
=====  Running Parameters    =====
2023-10-28 23:16:59,202 [INFO] {
    "amp": true,
    "batch_size_eval": 32,
    "batch_size_train": 32,
    "device": "cuda",
    "dist_backend": "nccl",
    "dist_url": "env://",
    "distributed": true,
    "evaluate": false,
    "gpu": 0,
    "init_lr": 0.0001,
    "iters_per_epoch": 5000,
    "lr_sched": "linear_warmup_cosine_lr",
    "max_epoch": 10,
    "min_lr": 8e-05,
    "num_workers": 16,
    "output_dir": "output/minigpt4_stage1_pretrain",
    "rank": 0,
    "resume_ckpt_path": null,
    "seed": 42,
    "task": "image_text_pretrain",
    "train_splits": [
        "train",
        "valid",
        "test"
    ],
    "warmup_lr": 1e-06,
    "warmup_steps": 5000,
    "weight_decay": 0.05,
    "world_size": 1
}
2023-10-28 23:16:59,202 [INFO] 
======  Dataset Attributes  ======
2023-10-28 23:16:59,203 [INFO] 
======== ct-seg =======
2023-10-28 23:16:59,203 [INFO] {
    "build_info": {
        "img_path": "/scratch/slurm-user3/changsun/data/ct-for-detect-seg/ct.h5",
        "size": "None",
        "transform": "None",
        "txt_path": "/scratch/slurm-user3/changsun/data/ct-for-detect-seg/ct_report.csv"
    },
    "data_type": "images",
    "sample_ratio": 115,
    "text_processor": {
        "train": {
            "name": "blip_caption"
        }
    },
    "vis_processor": {
        "train": {
            "image_size": 224,
            "name": "blip2_image_train"
        }
    }
}
2023-10-28 23:16:59,203 [INFO] 
======  Model Attributes  ======
2023-10-28 23:16:59,203 [INFO] {
    "arch": "mini_gpt4",
    "ckpt": "/scratch/slurm-user3/changsun/pretrained_minigpt4.pth",
    "drop_path_rate": 0,
    "end_sym": "###",
    "freeze_qformer": true,
    "freeze_vit": true,
    "image_size": 224,
    "llama_model": "/scratch/slurm-user3/changsun/vicuna-7b-v1.3/",
    "lora_alpha": 16,
    "lora_dropout": 0.05,
    "lora_r": 64,
    "lora_target_modules": [
        "q_proj",
        "v_proj"
    ],
    "low_resource": true,
    "max_txt_len": 160,
    "model_type": "pretrain_vicuna",
    "num_query_token": 32,
    "prompt": "",
    "prompt_path": "prompts/alignment_ct.txt",
    "prompt_template": "###Human: {} ###Assistant: ",
    "use_grad_checkpoint": false,
    "vit_precision": "fp16"
}
2023-10-28 23:16:59,203 [INFO] Building datasets...
2023-10-28 23:17:02,250 [INFO] freeze vision encoder
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:06<00:06,  6.34s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  3.94s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:08<00:00,  4.30s/it]
2023-10-28 23:17:18,249 [INFO] Start training
2023-10-28 23:17:18,402 [INFO] dataset_ratios not specified, datasets will be concatenated (map-style datasets) or chained (webdataset.DataPipeline).
2023-10-28 23:17:18,402 [INFO] Loaded 2501 records for train split from the dataset.
2023-10-28 23:17:18,414 [INFO] number of trainable parameters: 36704256
2023-10-28 23:17:18,414 [INFO] Start training epoch 0, 5000 iters per inner epoch.
/scratch/slurm-user3/changsun/minigpt4/minigpt4/models/mini_gpt4.py:389: UserWarning: Anomaly Detection has been enabled. This mode will increase the runtime and should only be enabled for debugging.
  with torch.autograd.detect_anomaly():
2023-10-28 23:17:24,487 [WARNING] `use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`...
/scratch/slurm-user3/anaconda3/envs/minigpt4/lib/python3.9/site-packages/bitsandbytes/autograd/_functions.py:298: UserWarning: MatMul8bitLt: inputs will be cast from torch.float32 to float16 during quantization
  warnings.warn(f"MatMul8bitLt: inputs will be cast from {A.dtype} to float16 during quantization")
2023-10-28 23:17:28,228 [INFO] Reducer buckets have been rebuilt in this iteration.
2023-10-29 02:58:51,680 [INFO] Averaged stats: lr: 0.0001  loss: 0.1706
2023-10-29 02:58:51,682 [INFO] No validation splits found.
2023-10-29 02:58:51,699 [INFO] Saving checkpoint at epoch 0 to /scratch/slurm-user3/changsun/minigpt4/minigpt4/output/minigpt4_stage1_pretrain/20231028231/checkpoint_0.pth.
2023-10-29 02:58:52,114 [INFO] Start training
2023-10-29 02:58:52,136 [INFO] Start training epoch 1, 5000 iters per inner epoch.
2023-10-29 06:40:30,239 [INFO] Averaged stats: lr: 0.0001  loss: 0.0455
2023-10-29 06:40:30,241 [INFO] No validation splits found.
2023-10-29 06:40:30,258 [INFO] Saving checkpoint at epoch 1 to /scratch/slurm-user3/changsun/minigpt4/minigpt4/output/minigpt4_stage1_pretrain/20231028231/checkpoint_1.pth.
2023-10-29 06:40:30,701 [INFO] Start training
2023-10-29 06:40:30,722 [INFO] Start training epoch 2, 5000 iters per inner epoch.
2023-10-29 10:21:58,208 [INFO] Averaged stats: lr: 0.0001  loss: 0.0430
2023-10-29 10:21:58,210 [INFO] No validation splits found.
2023-10-29 10:21:58,227 [INFO] Saving checkpoint at epoch 2 to /scratch/slurm-user3/changsun/minigpt4/minigpt4/output/minigpt4_stage1_pretrain/20231028231/checkpoint_2.pth.
2023-10-29 10:21:58,646 [INFO] Start training
2023-10-29 10:21:58,668 [INFO] Start training epoch 3, 5000 iters per inner epoch.
2023-10-29 14:02:30,780 [INFO] Averaged stats: lr: 0.0001  loss: 0.0398
2023-10-29 14:02:30,782 [INFO] No validation splits found.
2023-10-29 14:02:30,799 [INFO] Saving checkpoint at epoch 3 to /scratch/slurm-user3/changsun/minigpt4/minigpt4/output/minigpt4_stage1_pretrain/20231028231/checkpoint_3.pth.
2023-10-29 14:02:31,223 [INFO] Start training
2023-10-29 14:02:31,246 [INFO] Start training epoch 4, 5000 iters per inner epoch.
2023-10-29 17:43:27,490 [INFO] Averaged stats: lr: 0.0001  loss: 0.0367
2023-10-29 17:43:27,492 [INFO] No validation splits found.
2023-10-29 17:43:27,509 [INFO] Saving checkpoint at epoch 4 to /scratch/slurm-user3/changsun/minigpt4/minigpt4/output/minigpt4_stage1_pretrain/20231028231/checkpoint_4.pth.
2023-10-29 17:43:27,946 [INFO] Start training
2023-10-29 17:43:27,967 [INFO] Start training epoch 5, 5000 iters per inner epoch.
2023-10-29 21:25:05,272 [INFO] Averaged stats: lr: 0.0001  loss: 0.0342
2023-10-29 21:25:05,274 [INFO] No validation splits found.
2023-10-29 21:25:05,291 [INFO] Saving checkpoint at epoch 5 to /scratch/slurm-user3/changsun/minigpt4/minigpt4/output/minigpt4_stage1_pretrain/20231028231/checkpoint_5.pth.
2023-10-29 21:25:05,734 [INFO] Start training
2023-10-29 21:25:05,754 [INFO] Start training epoch 6, 5000 iters per inner epoch.
srun: Job step aborted: Waiting up to 32 seconds for job step to finish.
slurmstepd-hpc-pr-a-pod12: error: *** STEP 9958.0 ON hpc-pr-a-pod12 CANCELLED AT 2023-10-29T23:17:10 DUE TO TIME LIMIT ***
slurmstepd-hpc-pr-a-pod12: error: *** JOB 9958 ON hpc-pr-a-pod12 CANCELLED AT 2023-10-29T23:17:10 DUE TO TIME LIMIT ***
